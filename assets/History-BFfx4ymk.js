import{d as e,r as s,s as t,o as l,c as a,f as r,q as i,i as o,g as d,h as n,w as u,t as c,F as x,p as g,u as v,n as b,b as y,e as m}from"./vendor-Bz8EPWj3.js";import{a as p}from"./index-MvJkNOd8.js";const f={class:"min-h-screen py-12 px-4 sm:px-6 lg:px-8"},h={class:"max-w-6xl mx-auto"},w={class:"text-center mb-8"},I={class:"flex justify-center gap-4"},k=["disabled"],C={key:0,class:"flex items-center gap-2"},_={key:1},T=["disabled"],H={key:0,class:"text-center py-12"},M={key:1,class:"text-center py-12"},N={key:2,class:"space-y-6"},L={class:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-8"},j={class:"bg-white p-6 rounded-lg shadow border border-gray-200"},D={class:"text-2xl font-bold text-gray-900"},U={class:"bg-white p-6 rounded-lg shadow border border-gray-200"},O={class:"text-2xl font-bold text-red-600"},S={class:"bg-white p-6 rounded-lg shadow border border-gray-200"},W={class:"text-2xl font-bold text-orange-600"},A={class:"bg-white p-6 rounded-lg shadow border border-gray-200"},E={class:"text-2xl font-bold text-yellow-600"},G={class:"bg-white p-6 rounded-lg shadow border border-gray-200"},R={class:"text-2xl font-bold text-blue-600"},z={class:"bg-white shadow rounded-lg overflow-hidden"},F={class:"divide-y divide-gray-200"},B={class:"flex items-start justify-between"},V={class:"flex-1"},q={class:"flex items-center gap-3 mb-2"},K={class:"text-lg font-medium text-gray-900"},J={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600 mb-3"},P={class:"font-bold text-red-600"},Q={key:0,class:"flex flex-wrap gap-2"},X={key:0,class:"px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded-full"},Y={key:1,class:"text-sm text-green-600"},Z={class:"ml-4 flex flex-col gap-2"},$=["onClick"],ee=["onClick","disabled"],se={class:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto"},te={class:"p-6 border-b border-gray-200"},le={class:"flex justify-between items-start"},ae={class:"text-xl font-bold text-gray-900 mb-2"},re={class:"flex gap-2"},ie={class:"p-6"},oe={class:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6"},de={class:"text-center p-4 bg-blue-50 rounded-lg"},ne={class:"text-2xl font-bold text-blue-600"},ue={class:"text-center p-4 bg-red-50 rounded-lg"},ce={class:"text-2xl font-bold text-red-600"},xe={class:"text-center p-4 bg-orange-50 rounded-lg"},ge={class:"text-2xl font-bold text-orange-600"},ve={class:"text-center p-4 bg-yellow-50 rounded-lg"},be={class:"text-2xl font-bold text-yellow-600"},ye={class:"text-center p-4 bg-green-50 rounded-lg"},me={class:"text-2xl font-bold text-green-600"},pe={key:0},fe={class:"space-y-4"},he={class:"flex justify-between items-start mb-2"},we={class:"text-gray-600 mb-2"},Ie={key:0,class:"text-sm text-gray-500"},ke={key:1,class:"text-sm text-blue-600 mt-2"},Ce={key:1,class:"text-center py-8 text-green-600"},_e=e({__name:"History",setup(e){const _e=s([]),Te=s(!1),He=s(null),Me=s(!1),Ne=t(()=>_e.value.reduce((e,s)=>e+s.criticalIssues,0)),Le=t(()=>_e.value.reduce((e,s)=>e+(s.highIssues||0),0)),je=t(()=>_e.value.reduce((e,s)=>e+s.mediumIssues,0)),De=t(()=>_e.value.reduce((e,s)=>e+s.lowIssues,0)),Ue=async()=>{Te.value=!0;try{const e=await p.getScanHistory();_e.value=e.scans.map(e=>{var s,t,l,a,r;return{scanId:e.scan_id,fileName:e.filename,scanner:"TensorDetect"===e.scanner_used?"TensorDetect":"ModelScan",totalIssues:e.total_issues,criticalIssues:(null==(s=e.issues_by_severity)?void 0:s.CRITICAL)||0,highIssues:(null==(t=e.issues_by_severity)?void 0:t.HIGH)||0,mediumIssues:(null==(l=e.issues_by_severity)?void 0:l.MEDIUM)||0,lowIssues:(null==(a=e.issues_by_severity)?void 0:a.LOW)||0,scanTime:new Date(e.scan_time).getTime(),modelInfo:{framework:(null==(r=e.model_type)?void 0:r.includes("TensorFlow"))?"TensorFlow":"Other",format:e.model_type},issues:e.issues.map(e=>{const s={1:"LOW",2:"MEDIUM",3:"HIGH",4:"CRITICAL"};let t=String(e.severity||"unknown").toUpperCase();return isNaN(Number(e.severity))||(t=s[Number(e.severity)]||"UNKNOWN"),{severity:t,title:e.operator||e.op||"Unknown",description:e.description,location:e.location}})}}).sort((e,s)=>s.scanTime-e.scanTime)}catch(e){console.error("获取扫描历史失败:",e)}finally{Te.value=!1}},Oe=async()=>{if(confirm("确定要清除所有扫描历史记录吗？此操作不可撤销。"))try{await p.clearScanHistory(),await Ue()}catch(e){console.error("清除历史记录失败:",e),alert("清除历史记录失败，请稍后重试")}},Se=e=>"TensorDetect"===e?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800",We=e=>0===e?"安全":e>5?"高风险":e>2?"中风险":"低风险",Ae=e=>0===e.totalIssues?"bg-green-100 text-green-800":e.criticalIssues>0?"bg-red-100 text-red-800":e.highIssues&&e.highIssues>0?"bg-orange-100 text-orange-800":e.mediumIssues>0?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800",Ee=e=>0===e.totalIssues?"安全":e.criticalIssues>0?"严重风险":e.highIssues&&e.highIssues>0?"高风险":e.mediumIssues>0?"中风险":"低风险",Ge=e=>{switch(e){case"CRITICAL":return"bg-red-100 text-red-800";case"HIGH":return"bg-orange-100 text-orange-800";case"MEDIUM":return"bg-yellow-100 text-yellow-800";case"LOW":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},Re=e=>{switch(e){case"CRITICAL":return"text-red-800";case"HIGH":return"text-orange-800";case"MEDIUM":return"text-yellow-800";case"LOW":return"text-blue-800";default:return"text-gray-800"}};return l(()=>{Ue()}),(e,s)=>{const t=y("router-link");return m(),a("div",f,[r("div",h,[r("div",w,[s[3]||(s[3]=r("h2",{class:"text-3xl font-bold text-gray-900 mb-4"}," 扫描历史记录 ",-1)),s[4]||(s[4]=r("p",{class:"text-gray-600 mb-4"}," 查看所有模型扫描的历史记录和结果 ",-1)),r("div",I,[r("button",{onClick:Ue,disabled:Te.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[Te.value?(m(),a("span",C,[...s[2]||(s[2]=[r("div",{class:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1),o(" 刷新中... ",-1)])])):(m(),a("span",_,"刷新记录"))],8,k),r("button",{onClick:Oe,disabled:Te.value||0===_e.value.length,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," 清除历史 ",8,T)])]),Te.value&&0===_e.value.length?(m(),a("div",H,[...s[5]||(s[5]=[r("div",{class:"loading-spinner mx-auto mb-4"},null,-1),r("p",{class:"text-gray-600"},"正在加载扫描历史...",-1)])])):0===_e.value.length?(m(),a("div",M,[s[7]||(s[7]=d('<div class="text-gray-400 mb-4"><svg class="mx-auto h-24 w-24" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><h3 class="text-lg font-medium text-gray-900 mb-2">暂无扫描记录</h3><p class="text-gray-600 mb-4">开始扫描您的第一个模型文件</p>',3)),n(t,{to:"/",class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},{default:u(()=>[...s[6]||(s[6]=[o(" 开始扫描 ",-1)])]),_:1})])):(m(),a("div",N,[r("div",L,[r("div",j,[r("div",D,c(_e.value.length),1),s[8]||(s[8]=r("div",{class:"text-sm text-gray-600"},"总扫描次数",-1))]),r("div",U,[r("div",O,c(Ne.value),1),s[9]||(s[9]=r("div",{class:"text-sm text-gray-600"},"严重问题",-1))]),r("div",S,[r("div",W,c(Le.value),1),s[10]||(s[10]=r("div",{class:"text-sm text-gray-600"},"高风险问题",-1))]),r("div",A,[r("div",E,c(je.value),1),s[11]||(s[11]=r("div",{class:"text-sm text-gray-600"},"中等问题",-1))]),r("div",G,[r("div",R,c(De.value),1),s[12]||(s[12]=r("div",{class:"text-sm text-gray-600"},"轻微问题",-1))])]),r("div",z,[s[17]||(s[17]=r("div",{class:"px-6 py-4 border-b border-gray-200"},[r("h3",{class:"text-lg font-medium text-gray-900"},"扫描记录列表")],-1)),r("div",F,[(m(!0),a(x,null,g(_e.value,(e,t)=>{var l,o,d;return m(),a("div",{key:e.scanId||t,class:"p-6 hover:bg-gray-50 transition-colors"},[r("div",B,[r("div",V,[r("div",q,[r("h4",K,c(e.fileName),1),r("span",{class:b([Se(e.scanner),"px-2 py-1 text-xs font-medium rounded-full"])},c(e.scanner),3),r("span",{class:b([Ae(e),"px-2 py-1 text-xs font-medium rounded-full"])},c(Ee(e)),3)]),r("div",J,[r("div",null,[s[13]||(s[13]=r("span",{class:"font-medium"},"模型类型:",-1)),r("div",null,c((null==(l=e.modelInfo)?void 0:l.framework)||"Unknown"),1)]),r("div",null,[s[14]||(s[14]=r("span",{class:"font-medium"},"格式:",-1)),r("div",null,c((null==(o=e.modelInfo)?void 0:o.format)||"Unknown"),1)]),r("div",null,[s[15]||(s[15]=r("span",{class:"font-medium"},"扫描时间:",-1)),r("div",null,c((d=e.scanTime,new Date(d).toLocaleString("zh-CN"))),1)]),r("div",null,[s[16]||(s[16]=r("span",{class:"font-medium"},"发现问题:",-1)),r("div",P,c(e.totalIssues)+" 个",1)])]),e.issues.length>0?(m(),a("div",Q,[(m(!0),a(x,null,g(e.issues.slice(0,3),e=>(m(),a("div",{key:e.title,class:b([Ge(e.severity),"px-2 py-1 text-xs rounded-full"])},c(e.title),3))),128)),e.issues.length>3?(m(),a("div",X," +"+c(e.issues.length-3)+" 更多 ",1)):i("",!0)])):(m(),a("div",Y," ✓ 未发现安全问题 "))]),r("div",Z,[r("button",{onClick:s=>(e=>{He.value=e})(e),class:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"}," 查看详情 ",8,$),r("button",{onClick:s=>(e=>{console.log("重新扫描:",e.fileName)})(e),disabled:Me.value,class:"px-3 py-1 text-sm bg-gray-600 text-white rounded hover:bg-gray-700 disabled:opacity-50 transition-colors"}," 重新扫描 ",8,ee)])])])}),128))])])])),He.value?(m(),a("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:s[1]||(s[1]=v(e=>He.value=null,["self"]))},[r("div",se,[r("div",te,[r("div",le,[r("div",null,[r("h3",ae,c(He.value.fileName),1),r("div",re,[r("span",{class:b([Se(He.value.scanner),"px-2 py-1 text-xs font-medium rounded-full"])},c(He.value.scanner),3),r("span",{class:b([(l=He.value.totalIssues,0===l?"bg-green-100 text-green-800":l>5?"bg-red-100 text-red-800":l>2?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"),"px-2 py-1 text-xs font-medium rounded-full"])},c(We(He.value.totalIssues)),3)])]),r("button",{onClick:s[0]||(s[0]=e=>He.value=null),class:"text-gray-400 hover:text-gray-600"},[...s[18]||(s[18]=[r("svg",{class:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),r("div",ie,[r("div",oe,[r("div",de,[r("div",ne,c(He.value.totalIssues),1),s[19]||(s[19]=r("div",{class:"text-sm text-gray-600"},"总问题数",-1))]),r("div",ue,[r("div",ce,c(He.value.criticalIssues),1),s[20]||(s[20]=r("div",{class:"text-sm text-gray-600"},"严重问题",-1))]),r("div",xe,[r("div",ge,c(He.value.highIssues||0),1),s[21]||(s[21]=r("div",{class:"text-sm text-gray-600"},"高风险问题",-1))]),r("div",ve,[r("div",be,c(He.value.mediumIssues),1),s[22]||(s[22]=r("div",{class:"text-sm text-gray-600"},"中等问题",-1))]),r("div",ye,[r("div",me,c(He.value.lowIssues),1),s[23]||(s[23]=r("div",{class:"text-sm text-gray-600"},"轻微问题",-1))])]),He.value.issues.length>0?(m(),a("div",pe,[s[26]||(s[26]=r("h4",{class:"text-lg font-semibold text-gray-900 mb-4"},"问题详情",-1)),r("div",fe,[(m(!0),a(x,null,g(He.value.issues,e=>(m(),a("div",{key:e.title,class:"border border-gray-200 rounded-lg p-4"},[r("div",he,[r("h5",{class:b([Re(e.severity),"font-medium"])},c(e.title),3),r("span",{class:b([Ge(e.severity),"px-2 py-1 text-xs rounded-full"])},c(e.severity),3)]),r("p",we,c(e.description),1),e.location?(m(),a("div",Ie,[s[24]||(s[24]=r("strong",null,"位置:",-1)),o(" "+c(e.location),1)])):i("",!0),e.recommendation?(m(),a("div",ke,[s[25]||(s[25]=r("strong",null,"建议:",-1)),o(" "+c(e.recommendation),1)])):i("",!0)]))),128))])])):(m(),a("div",Ce," ✓ 未发现安全问题 "))])])])):i("",!0)])]);var l}}});export{_e as default};
